<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NGL Reading Explorer - Unified Report System (RE报告统一生成系统)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;500;600;700&family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Montserrat', "Microsoft YaHei", sans-serif; 
            margin: 0;
            background-color: #f1f5f9; 
            color: #1e293b;
        }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(0, 0, 0, 0.1); border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: rgba(0, 0, 0, 0.2); }
        
        * {
            -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;
        }

        .ngl-square {
            width: 32px;
            height: 48px;
            border: 6px solid #FFDD00; 
            flex-shrink: 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.4);
        }

        .poster-canvas {
            font-variant-ligatures: none;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
            image-rendering: -webkit-optimize-contrast;
            font-feature-settings: "kern" 0; 
        }
        
        /* Session Report Specifics */
        select.session-select {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            background-size: 1em;
        }

        /* Course Report Specifics (Export Fixes) */
        .export-fix-base { transition: transform 0.2s; } 
        .export-fix-sm { transition: transform 0.2s; }   
        .export-fix-emoji { transition: transform 0.2s; } 
        .export-fix-circle-num { transition: transform 0.2s; } 
        .export-fix-main-title { transition: transform 0.2s; } 
        .export-fix-logo-text { transition: transform 0.2s; }

        .text-halo {
            paint-order: stroke fill;
            stroke: rgba(255, 255, 255, 0.95);
            stroke-width: 2.5px;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        .control-group {
            margin-bottom: 1rem;
            background: #fff;
            padding: 1rem;
            border-radius: 0.75rem;
            border: 1px solid #e2e8f0;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }
        .control-label {
            display: block;
            font-size: 0.75rem;
            font-weight: 700;
            color: #475569;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .input-field {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #cbd5e1;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            transition: all 0.2s;
            background-color: #f8fafc;
        }
        .input-field:focus {
            outline: none;
            border-color: #8b5cf6;
            background-color: #fff;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }
        
        svg { display: block; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect, useMemo } = React;

        // --- Shared Constants ---
        const LEVEL_DATA_MAP = {
            "Level 0": { lexile: "500L", cefr: "A1-A2", ielts: "3.0", toefl: "0-20", mse: "Flyers" },
            "Foundations": { lexile: "700L", cefr: "A2+", ielts: "3.5-4.5", toefl: "0-34", mse: "KET" },
            "Level 1": { lexile: "820L", cefr: "A2-B1", ielts: "4.5-5.0", toefl: "32-40", mse: "PET" },
            "Level 2": { lexile: "960L", cefr: "B1+", ielts: "5.0", toefl: "35-45", mse: "PET+" },
            "Level 3": { lexile: "1050L", cefr: "B1-B2", ielts: "5.0-6.0", toefl: "40-78", mse: "FCE" },
            "Level 4": { lexile: "1140L", cefr: "B2+", ielts: "5.5-6.5", toefl: "60-93", mse: "FCE+" },
            "Level 5": { lexile: "1190L", cefr: "C1", ielts: "7.0-8.0", toefl: "94-115", mse: "CAE" }
        };

        const LEVEL_OPTIONS = Object.keys(LEVEL_DATA_MAP);

        const COMMENT_PRESETS = {
            "Flyers (Pre-A2)": [
                "掌握约 500-800 个核心基础词汇，能运用一般现在时、现在进行时等最基础时态，可构造简单的主谓宾短句，但名词单复数和人称代词的使用仍需强化。",
                "能听懂并回应非常简单的日常指令、问候及物品名称提问；可进行简短的自我介绍和喜好表达，但发音清晰度和句子连贯性有待提升。",
                "能识别熟悉的单词和标志，读懂包含高频词汇的简单句子；写作可完成单词和短句的抄写，能填写含个人基本信息的简单表格，但尚无法独立写出完整句子。",
                "通过动画和绘本积累听力词汇，每日进行 10-15 分钟的跟读模仿；用词汇卡片强化高频词的音形对应，尝试用学过的词汇和基础句式记录日常活动（如 I ate an apple today），逐步建立 “输入→输出” 的学习闭环。"
            ],
            "A2 级 (Foundations)": [
                "掌握基础高频词汇（约 1000 词），能运用一般现在时、过去时等基础时态，可构造简单陈述句，但动词变位和名词单复数仍需巩固。",
                "能听懂并回应日常指令、简单问候及个人信息提问；可进行基础自我介绍，但发音准确性和句子流利度有待提升。",
                "能识别短文中的时间、地点等关键信息；写作可完成简单句子的拼接，能填写个人信息类表格，但尚无法构建完整段落。",
                "每日坚持绘本或分级阅读，积累场景化词汇；通过跟读模仿纠正发音，并用英语记录每日简单事件（如天气、活动）。"
            ],
            "A2-B1 级 (Level 1)": [
                "词汇量约 1500-2000 词，能运用现在完成时、将来时等复合时态，可构造简单复合句，但介词搭配和从句连接词使用仍有错误。",
                "能参与熟悉话题的日常对话，能听懂语速较慢的简短独白；表达基本连贯，但复杂想法难以清晰传递。",
                "能读懂短篇故事和通知，把握主旨大意；写作可完成连贯的段落，但逻辑衔接较弱，建议学习使用基础连接词（如 and, but）。",
                "增加分级阅读量，每周完成 1-2 篇仿写练习；利用碎片化时间进行听力泛听，积累口语常用短语。"
            ],
            "B1 级 (Level 2)": [
                "词汇量约 2500-3000 词，能运用多种时态和条件句，可构造包含定语从句的复杂句子，但虚拟语气和非谓语动词使用仍不熟练。",
                "能就熟悉话题发表个人观点，能听懂中等语速的新闻片段；表达流利度提升，但语调单一，缺乏自然停顿。",
                "能读懂说明文和简单议论文，提炼核心观点；写作可完成结构清晰的短文，但论点支撑不足，建议学习举例和细节补充技巧。",
                "每周完成 1 篇主题写作并修改；加入英语角或语伴交流，提升口语实战能力；阅读原版短篇故事，积累地道表达。"
            ],
            "B1-B2 级 (Level 3)": [
                "词汇量约 3500-4000 词，能熟练运用各类时态和从句，可准确使用虚拟语气，但固定搭配和习语的精准度有待提升。",
                "能就抽象话题（如环保、教育）展开讨论，能听懂正常语速的广播和讲座；表达较流利，但复杂观点的组织效率可进一步优化。",
                "能读懂中等难度的文章，分析逻辑结构；写作可完成完整议论文，但论证深度不够，建议学习驳论和拓展论据的方法。",
                "阅读英文原版教材或新闻，积累学术词汇；定期进行录音复盘，优化口语表达的逻辑性；学习使用高级连接词（如 however, therefore）。"
            ],
            "B2 级 (Level 4)": [
                "词汇量约 5000-6000 词，能精准运用复杂语法结构，包括非谓语动词、倒装句等，能区分正式与非正式语境下的语言差异。",
                "能进行流利的学术讨论和专业交流，能听懂复杂的演讲和辩论；表达地道且语调自然，但需提升跨文化交际中的语用能力。",
                "能读懂专业领域的文章，进行批判性分析；写作可完成高质量的学术论文，但需优化长难句的可读性，学习简洁表达的技巧。",
                "参与学术辩论或小组展示，提升思辨能力；精读高分范文，总结写作框架和高级表达；定期收听 TED 演讲，积累观点和表达。"
            ],
            "C1 级 (Level 5)": [
                "词汇量达 8000 词以上，能熟练运用各类复杂句式和书面语表达，精准把握正式与非正式语境的语言差异。",
                "能进行专业领域的深度交流和即兴演讲，表达流畅且富有感染力；能听懂各类口音的高难度音频，并捕捉隐含信息。",
                "能读懂高难度的文献和思辨性文章，独立撰写学术报告和研究论文；写作逻辑严谨，语言精准，但可进一步提升风格多样性。",
                "定期阅读权威期刊，积累前沿观点；尝试进行内容创作（如博客、专栏），深化语言运用的灵活性；参与高阶英语角，讨论复杂议题。"
            ]
        };

        const Icon = ({ name, size = 24 }) => {
            const icons = {
                plus: <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>,
                trash: <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>,
                check: <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" style={{ display: 'block' }}><polyline points="20 6 9 17 4 12"></polyline></svg>,
                download: <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>,
                settings: <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1-2-2 2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>,
                loader: <svg className="animate-spin" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="2" x2="12" y2="6"></line><line x1="12" y1="18" x2="12" y2="22"></line><line x1="4.93" y1="4.93" x2="7.76" y2="7.76"></line><line x1="16.24" y1="16.24" x2="19.07" y2="19.07"></line><line x1="2" y1="12" x2="6" y2="12"></line><line x1="18" y1="12" x2="22" y2="12"></line><line x1="4.93" y1="19.07" x2="7.76" y2="16.24"></line><line x1="16.24" y1="7.76" x2="19.07" y2="4.93"></line></svg>,
                arrowRight: <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>,
                calendar: <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
            };
            return icons[name] || null;
        };

        // ==========================================
        // MODULE 1: Session Report (Daily/Weekly)
        // ==========================================

        const SessionRadarChart = ({ data, size = 240 }) => {
            const center = size / 2;
            const radius = size * 0.3; 
            const levels = 4; 
            const keys = ["词汇掌握", "语法运用", "听说表达", "阅读能力", "写作能力"];
            
            const getCoordinates = (value, index, total, maxVal = 100) => {
                const angle = (Math.PI * 2 * index) / total - Math.PI / 2;
                const r = (value / maxVal) * radius;
                return {
                    x: center + r * Math.cos(angle),
                    y: center + r * Math.sin(angle)
                };
            };

            const gridPoints = useMemo(() => {
                const grids = [];
                for (let i = 1; i <= levels; i++) {
                    const points = [];
                    for (let j = 0; j < keys.length; j++) {
                        const { x, y } = getCoordinates(100 * (i / levels), j, keys.length);
                        points.push(`${x},${y}`);
                    }
                    grids.push(points.join(" "));
                }
                return grids;
            }, [levels, keys.length]);

            const dataPoints = useMemo(() => {
                const points = keys.map((key, i) => {
                    const val = data[key] || 0;
                    const { x, y } = getCoordinates(val, i, keys.length);
                    return `${x},${y}`;
                });
                return points.join(" ");
            }, [data, keys]);

            const labels = keys.map((key, i) => {
                const { x, y } = getCoordinates(125, i, keys.length);
                return { key, x, y };
            });

            return (
                <div className="flex justify-center items-center py-2">
                    <svg width={size} height={size} viewBox={`0 0 ${size} ${size}`} className="overflow-visible">
                        {gridPoints.map((points, i) => (
                            <polygon key={i} points={points} fill="none" stroke="#cbd5e1" strokeWidth="1" />
                        ))}
                        {keys.map((_, i) => {
                            const { x, y } = getCoordinates(100, i, keys.length);
                            return <line key={i} x1={center} y1={center} x2={x} y2={y} stroke="#cbd5e1" strokeWidth="1" />;
                        })}
                        <polygon points={dataPoints} fill="rgba(255, 221, 0, 0.3)" stroke="#FFDD00" strokeWidth="2.5" />
                        {keys.map((key, i) => {
                             const val = data[key] || 0;
                             const { x, y } = getCoordinates(val, i, keys.length);
                             return <circle key={i} cx={x} cy={y} r="3.5" fill="#1e3a8a" stroke="#FFDD00" strokeWidth="1.5" />;
                        })}
                        {labels.map((label, i) => (
                            <text key={i} x={label.x} y={label.y} textAnchor="middle" dominantBaseline="middle" fill="#1e293b" className="text-[11px] font-bold tracking-widest" style={{ fontFamily: '"Microsoft YaHei", sans-serif' }}>
                                {label.key} <tspan fill="#b45309" style={{ fontSize: '12px' }}>{data[label.key] || 0}</tspan>
                            </text>
                        ))}
                    </svg>
                </div>
            );
        };

        const SessionGrowthChart = ({ start, target, width = 330, height = 180 }) => { 
            const dimensions = [
                { key: "level", label: "RE Level" },
                { key: "lexile", label: "Lexile" },
                { key: "cefr", label: "CEFR" },
                { key: "ielts", label: "IELTS" },
                { key: "toefl", label: "TOEFL" },
                { key: "mse", label: "MSE" },
            ];

            const normalize = (key, value) => {
                let valStr = String(value).toUpperCase().trim();
                const extractNum = (str) => {
                    const match = str.match(/([\d.]+)\s*[-]\s*([\d.]+)/);
                    if (match) return (parseFloat(match[1]) + parseFloat(match[2])) / 2;
                    return parseFloat(str.replace(/[^0-9.]/g, '')) || 0;
                };

                if (key === 'level') { 
                    const levelMap = { 'LEVEL 0': 0, 'FOUNDATIONS': 14, 'LEVEL 1': 28, 'LEVEL 2': 42, 'LEVEL 3': 56, 'LEVEL 4': 70, 'LEVEL 5': 84, 'C2': 100 };
                    for (let k in levelMap) { if (valStr.includes(k)) return levelMap[k]; }
                    const num = extractNum(valStr);
                    return Math.min(100, (num / 6) * 100); 
                }
                if (key === 'lexile') { const num = extractNum(valStr); return Math.min(100, (num / 1300) * 100); }
                if (key === 'cefr') { 
                    if (valStr.includes('C2')) return 100;
                    if (valStr.includes('C1')) return 90;
                    if (valStr.includes('B2+')) return 78;
                    if (valStr.includes('B2')) return 70;
                    if (valStr.includes('B1+')) return 58;
                    if (valStr.includes('B1')) return 50;
                    if (valStr.includes('A2+')) return 38;
                    if (valStr.includes('A2')) return 30;
                    if (valStr.includes('A1')) return 15;
                    return 20;
                }
                if (key === 'ielts') { const num = extractNum(valStr); return Math.min(100, (num / 9) * 100); }
                if (key === 'toefl') { const num = extractNum(valStr); return num > 120 ? Math.min(100, (num / 900) * 100) : Math.min(100, (num / 120) * 100); }
                if (key === 'mse') { 
                    if (valStr.includes('FLYERS')) return 10;
                    if (valStr.includes('KET')) return 25;
                    if (valStr.includes('PET+')) return 55; 
                    if (valStr.includes('PET')) return 40;
                    if (valStr.includes('FCE+')) return 85; 
                    if (valStr.includes('FCE')) return 70;
                    if (valStr.includes('CAE')) return 95;
                    if (valStr.includes('CPE')) return 100;
                    return 20;
                }
                return 50;
            };

            const padding = { top: 25, right: 20, bottom: 30, left: 25 }; 
            const chartWidth = width - padding.left - padding.right;
            const chartHeight = height - padding.top - padding.bottom;
            const stepX = chartWidth / (dimensions.length - 1);

            const startPoints = dimensions.map((d, i) => {
                const y = chartHeight - (normalize(d.key, start[d.key]) / 100) * chartHeight;
                return { x: i * stepX + padding.left, y: y + padding.top, val: start[d.key] };
            });

            const targetPoints = dimensions.map((d, i) => {
                const y = chartHeight - (normalize(d.key, target[d.key]) / 100) * chartHeight;
                return { x: i * stepX + padding.left, y: y + padding.top, val: target[d.key] };
            });

            const createPath = (points) => points.map((p, i) => (i === 0 ? `M ${p.x} ${p.y}` : `L ${p.x} ${p.y}`)).join(' ');
            const areaPath = `${createPath(startPoints)} L ${targetPoints[targetPoints.length - 1].x} ${targetPoints[targetPoints.length - 1].y} ${targetPoints.slice().reverse().map(p => `L ${p.x} ${p.y}`).join(' ')} Z`;

            return (
                <div className="flex justify-center items-center w-full"> 
                    <svg width={width} height={height} className="overflow-visible"> 
                        {dimensions.map((d, i) => (
                            <text key={i} x={i * stepX + padding.left} y={height - 5} textAnchor="middle" className="text-[8px] font-bold fill-gray-500 uppercase tracking-tighter" style={{ fontFamily: '"Oswald", sans-serif' }}>{d.label}</text>
                        ))}
                        <path d={areaPath} fill="rgba(255, 221, 0, 0.15)" stroke="none" />
                        <path d={createPath(startPoints)} fill="none" stroke="#1e3a8a" strokeWidth="2" strokeDasharray="4 2" />
                        <path d={createPath(targetPoints)} fill="none" stroke="#ca8a04" strokeWidth="2" />
                        {startPoints.map((p, i) => (
                            <g key={`start-${i}`}>
                                <circle cx={p.x} cy={p.y} r="2.5" fill="white" stroke="#1e3a8a" strokeWidth="1.5" />
                                <text x={p.x} y={p.y + 10} textAnchor="middle" className="text-[7px] font-bold fill-blue-900" style={{ fontFamily: 'sans-serif' }}>{p.val}</text>
                            </g>
                        ))}
                        {targetPoints.map((p, i) => (
                            <g key={`target-${i}`}>
                                <circle cx={p.x} cy={p.y} r="2.5" fill="white" stroke="#ca8a04" strokeWidth="1.5" />
                                <text x={p.x} y={p.y - 5} textAnchor="middle" className="text-[7px] font-bold fill-yellow-700" style={{ fontFamily: 'sans-serif' }}>{p.val}</text>
                            </g>
                        ))}
                    </svg>
                </div>
            );
        };

        const SessionPosterCard = ({ innerRef, studentName, teacherName, level, articleTitle, readingSkills, vocabCount, grammarKnowledge, radarData, tips, growthData }) => (
            <div ref={innerRef} className="poster-canvas relative w-[480px] min-h-[840px] bg-cover bg-center flex flex-col p-8 font-sans overflow-hidden rounded-xl shadow-2xl"
                    style={{ 
                        backgroundImage: `linear-gradient(105deg, rgba(15, 23, 42, 0.95) 0%, rgba(30, 58, 138, 0.7) 50%, rgba(30, 58, 138, 0) 100%), url('https://images.unsplash.com/photo-1585409677983-0f6c41ca9c3b?auto=format&fit=crop&q=85&w=2070')`,
                        backgroundPosition: 'center 15%', 
                        backgroundColor: '#1e3a8a'
                    }}>
                
                <header className="mb-8 flex flex-col items-start gap-6 relative z-10 w-full">
                    <div className="flex justify-between items-start w-full">
                        <div className="items-center gap-3" style={{display: 'flex'}}>
                            <div className="ngl-square shadow-lg"></div>
                            <div className="font-['Oswald'] uppercase tracking-wider text-shadow-md">
                                <h1 className="text-2xl font-bold leading-tight text-white drop-shadow-md">National Geographic</h1>
                                <p className="text-base tracking-[0.2em] text-gray-200 leading-tight drop-shadow-md">Learning</p>
                                <p className="text-[10px] tracking-[0.4em] text-yellow-400 mt-1 font-bold leading-tight drop-shadow-md">READING EXPLORER</p>
                            </div>
                        </div>
                    </div>
                    
                    <div className="border-l-4 border-yellow-500 pl-5 flex flex-col justify-center min-h-[90px]">
                        <h2 id="header-title-fix-1" className="text-[40px] font-bold text-white leading-none tracking-widest mb-3 drop-shadow-lg" style={{ fontFamily: '"Microsoft YaHei", sans-serif', lineHeight: '1.1' }}>
                            文思阅球
                        </h2>
                        <div style={{ display: 'flex', alignItems: 'center', marginTop: '15px' }}>
                            <div style={{ 
                                display: 'flex', alignItems: 'center', justifyContent: 'center',
                                backgroundColor: '#EAB308', color: 'black', fontSize: '14px',
                                fontWeight: '800', padding: '0 10px', height: '26px',    
                                borderRadius: '2px', letterSpacing: '0.15em',
                                boxShadow: '0 10px 15px -3px rgba(0, 0, 0, 0.1)', marginRight: '12px'
                            }}>
                                <span id="badge-text-fix" style={{ lineHeight: '1' }}>学习报告</span>
                            </div>
                            <div style={{ width: '32px', height: '1px', backgroundColor: 'rgba(255, 255, 255, 0.5)', marginRight: '12px', boxShadow: '0 1px 2px 0 rgba(0, 0, 0, 0.05)' }}></div>
                            <span id="subtitle-fix" style={{
                                fontSize: '10px', color: '#d1d5db', fontWeight: '500',
                                letterSpacing: '0.1em', textTransform: 'uppercase',
                                filter: 'drop-shadow(0 4px 3px rgb(0 0 0 / 0.07)) drop-shadow(0 2px 2px rgb(0 0 0 / 0.06))',
                                lineHeight: '1'
                            }}>
                                RE阅读探索者 · 体验营
                            </span>
                        </div>
                    </div>
                </header>

                <div className="bg-white rounded-lg overflow-hidden flex-grow flex flex-col shadow-2xl relative z-10">
                    <div className="bg-gray-50 px-6 py-4 border-b border-gray-100 flex items-center h-[60px]">
                        <div className="flex items-center gap-3">
                            <div className="flex items-center gap-1.5">
                                <span className="text-[10px] text-gray-400 font-bold uppercase tracking-wider">STUDENT</span>
                                <span id="student-name-fix" className="text-base text-blue-900 font-['Oswald'] uppercase tracking-widest font-bold" style={{ lineHeight: '1' }}>{studentName}</span>
                            </div>
                            <span className="text-gray-300">|</span>
                            <div className="flex items-center gap-1.5">
                                <span className="text-[10px] text-gray-400 font-bold uppercase tracking-wider">LEVEL</span>
                                <span id="level-text-fix" className="text-base text-blue-900 font-['Oswald'] uppercase tracking-widest font-bold" style={{ lineHeight: '1' }}>{level}</span>
                            </div>
                            <span className="text-gray-300">|</span>
                            <div className="flex items-center gap-1.5">
                                <span className="text-[10px] text-gray-400 font-bold uppercase tracking-wider">TEACHER</span>
                                <span id="teacher-name-fix" className="text-base text-blue-900 font-['Oswald'] uppercase tracking-widest font-bold" style={{ lineHeight: '1' }}>{teacherName}</span>
                            </div>
                        </div>
                    </div>

                    <div className="p-6 flex-grow">
                        <section className="border-l-[8px] border-blue-900 pl-5 mb-8">
                            <h3 className="font-['Oswald'] text-lg font-bold mb-4 text-blue-900 uppercase">Learning Content / 学习内容</h3>
                            <div className="space-y-4">
                                {[
                                    { label: "Article Title / 文章题目", value: articleTitle },
                                    { label: "Reading Skills / 阅读技巧", value: readingSkills },
                                    { label: "Vocabulary Count / 词汇数量", value: vocabCount },
                                    { label: "Grammar Knowledge / 语法知识", value: grammarKnowledge }
                                ].map((item, idx) => (
                                    <div key={idx} className="relative py-2 border-b border-gray-100 min-h-[40px] pl-9 flex flex-col justify-center">
                                        <div className="absolute left-0 top-[10px] w-6 h-6 rounded border border-blue-100 flex items-center justify-center bg-blue-50 text-blue-900">
                                            <div className="w-1.5 h-1.5 bg-blue-900 rounded-full"></div>
                                        </div>
                                        <div className="text-[9px] text-gray-400 uppercase tracking-wider font-bold mb-0.5">{item.label}</div>
                                        <div className="task-text-fix text-sm font-medium text-gray-800 leading-relaxed">
                                            {item.value}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </section>

                        <section className="mb-5">
                            <h4 className="font-['Oswald'] text-sm font-bold mb-2 flex items-center gap-2 uppercase text-gray-800 justify-center">
                                <span className="w-1.5 h-4 bg-yellow-500"></span> Ability Radar / 综合能力评估
                            </h4>
                            <SessionRadarChart data={radarData} />
                        </section>
                        
                        <section className="mb-10">
                            <h4 className="font-['Oswald'] text-sm font-bold mb-4 flex items-center gap-2 uppercase text-gray-800">
                                <span className="w-1.5 h-4 bg-yellow-500"></span> Diagnosis & Advice / 能力诊断与提升建议
                            </h4>
                            <div className="bg-gray-50 rounded-lg p-5 border border-gray-100 space-y-4">
                                {tips.map((tip, idx) => (
                                    <div key={tip.id} className="flex gap-4 relative">
                                        <span className="font-['Oswald'] text-blue-900 font-bold text-base w-6 flex-shrink-0">{(idx + 1).toString().padStart(2, '0')}</span>
                                        <div className="flex-grow">
                                            <p className="text-sm text-gray-800 leading-relaxed font-semibold mb-1">{tip.title}</p>
                                            {tip.subTips && tip.subTips.length > 0 && (
                                                <div className="pl-3 border-l-2 border-yellow-400 space-y-1.5 mt-2">
                                                    {tip.subTips.map((sub, sIdx) => <p key={sIdx} className="text-[11px] text-gray-500 leading-normal font-medium">• {sub}</p>)}
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </section>

                        <section>
                            <h4 className="font-['Oswald'] text-sm font-bold mb-4 flex items-center gap-2 uppercase text-gray-800">
                                <span className="w-1.5 h-4 bg-yellow-500"></span> Ability Growth Blueprint / 能力起点与成长蓝图
                            </h4>
                            <div className="bg-gray-50 rounded-lg border border-gray-200 overflow-hidden p-4">
                                <div className="flex justify-between mb-2 px-2">
                                    <div className="flex items-center gap-2">
                                        <span className="w-3 h-1 bg-blue-900 border border-blue-900 border-dashed"></span>
                                        <span className="text-[10px] text-gray-500 font-bold">Start</span>
                                    </div>
                                    <div className="flex items-center gap-2">
                                        <span className="w-3 h-1 bg-yellow-600"></span>
                                        <span className="text-[10px] text-gray-500 font-bold">Goal</span>
                                    </div>
                                </div>
                                <SessionGrowthChart start={growthData.start} target={growthData.target} width={330} />
                            </div>
                        </section>
                    </div>
                </div>

                <footer className="mt-8 flex flex-col items-center relative z-10">
                    <div className="text-white/80 text-center text-[9px] uppercase tracking-wider leading-none mb-4 font-semibold drop-shadow-md">
                        Bring the world to the classroom, and the classroom to life.
                    </div>
                    <div className="w-full border-t border-white/30 pt-2"></div>
                </footer>
            </div>
        );

        const SessionReportApp = () => {
            const [studentName, setStudentName] = useState("Alex");
            const [teacherName, setTeacherName] = useState("Vicky");
            const [level, setLevel] = useState("2");
            const [articleTitle, setArticleTitle] = useState("Sweet Love");
            const [readingSkills, setReadingSkills] = useState("Skimming & Scanning");
            const [vocabCount, setVocabCount] = useState("20 Words");
            const [grammarKnowledge, setGrammarKnowledge] = useState("Simple Past Tense");
            const [radarData, setRadarData] = useState({ "词汇掌握": 70, "语法运用": 65, "听说表达": 75, "阅读能力": 70, "写作能力": 60 });
            const [growthData, setGrowthData] = useState({
                start: { level: "Level 1", lexile: "820L", cefr: "A2-B1", ielts: "4.5-5.0", toefl: "32-40", mse: "PET" },
                target: { level: "Level 2", lexile: "960L", cefr: "B1+", ielts: "5.0", toefl: "35-45", mse: "PET+" }
            });
            const [tips, setTips] = useState([
                { id: 1, title: "词汇语法 / Vocabulary & Grammar", subTips: ["基础词汇积累起步，简单句式运用尚可，需加强动词变位规则的记忆。"] },
                { id: 2, title: "听说表达 / Listening & Speaking", subTips: ["能听懂简单的日常指令，建议多模仿跟读以纠正基础发音。"] },
                { id: 3, title: "读写能力 / Reading & Writing", subTips: ["能识别短文中的关键信息，写作尚处于句子构建阶段，建议多做看图写话练习。"] },
                { id: 4, title: "后续建议 / Future Suggestions", subTips: ["坚持每日绘本阅读，建立语感；尝试用英语记录简单的日常生活。"] },
            ]);
            const [isExporting, setIsExporting] = useState(false);
            const posterRef = useRef(null);
            
            const addTip = () => setTips([...tips, { id: Date.now(), title: "新诊断", subTips: [] }]);
            const removeTip = (id) => setTips(tips.filter(t => t.id !== id));
            const updateTip = (id, title) => setTips(tips.map(t => t.id === id ? { ...t, title } : t));
            const addSubTip = (tipId) => setTips(tips.map(tip => tip.id === tipId ? { ...tip, subTips: [...(tip.subTips || []), "新详细记录"] } : tip));
            const updateSubTip = (tipId, subIndex, newText) => setTips(tips.map(tip => { if (tip.id === tipId) { const newSubTips = [...tip.subTips]; newSubTips[subIndex] = newText; return { ...tip, subTips: newSubTips }; } return tip; }));
            const removeSubTip = (tipId, subIndex) => setTips(tips.map(tip => { if (tip.id === tipId) { const newSubTips = tip.subTips.filter((_, i) => i !== subIndex); return { ...tip, subTips: newSubTips }; } return tip; }));
            const updateRadarData = (key, value) => setRadarData(prev => ({ ...prev, [key]: parseInt(value) || 0 }));
            const updateGrowthData = (type, key, value) => setGrowthData(prev => ({ ...prev, [type]: { ...prev[type], [key]: value } }));
            const handleLevelChange = (type, newLevel) => {
                const mapData = LEVEL_DATA_MAP[newLevel];
                if (mapData) setGrowthData(prev => ({ ...prev, [type]: { level: newLevel, ...mapData } }));
                else updateGrowthData(type, 'level', newLevel);
            };
            const applyCommentPreset = (presetName) => {
                const preset = COMMENT_PRESETS[presetName];
                if (!preset) return;
                setTips([
                    { id: 1, title: "词汇语法 / Vocabulary & Grammar", subTips: [preset[0]] },
                    { id: 2, title: "听说表达 / Listening & Speaking", subTips: [preset[1]] },
                    { id: 3, title: "读写能力 / Reading & Writing", subTips: [preset[2]] },
                    { id: 4, title: "后续建议 / Future Suggestions", subTips: [preset[3]] },
                ]);
            };

            const handleExport = async () => {
                if (isExporting) return;
                setIsExporting(true);
                try {
                    await document.fonts.ready;
                    const element = posterRef.current;
                    const canvas = await html2canvas(element, { useCORS: true, scale: 2, backgroundColor: null, logging: false, allowTaint: true, fontStyle: 'normal',
                        onclone: (clonedDoc) => {
                            const headerTitle = clonedDoc.getElementById('header-title-fix-1');
                            if (headerTitle) { headerTitle.style.position = 'relative'; headerTitle.style.top = '-8px'; headerTitle.style.color = '#ffffff'; }
                            const badgeTextFix = clonedDoc.getElementById('badge-text-fix');
                            if (badgeTextFix) { badgeTextFix.style.position = 'relative'; badgeTextFix.style.top = '-5.5px'; }
                            const subtitleFix = clonedDoc.getElementById('subtitle-fix');
                            if (subtitleFix) { subtitleFix.style.position = 'relative'; subtitleFix.style.top = '-4.0px'; }
                            const taskTexts = clonedDoc.querySelectorAll('.task-text-fix');
                            taskTexts.forEach(el => { el.style.position = 'relative'; el.style.top = '-4.5px'; });
                            ['student-name-fix', 'level-text-fix', 'teacher-name-fix'].forEach(id => {
                                const el = clonedDoc.getElementById(id);
                                if (el) { el.style.fontSize = '16px'; el.style.position = 'relative'; el.style.top = '-4px'; }
                            });
                        }
                    });
                    const image = canvas.toDataURL("image/png", 1.0);
                    const link = document.createElement('a');
                    link.href = image;
                    link.download = `Reading-Camp-${studentName}.png`;
                    link.click();
                } catch (error) { console.error("Export Error:", error); } finally { setIsExporting(false); }
            };

            return (
                <div className="flex flex-col md:flex-row gap-8">
                     <aside className="w-full md:w-96 flex flex-col gap-6 overflow-y-auto pr-2 custom-scrollbar pb-10">
                        <div className="bg-white p-5 rounded-xl border border-gray-200 space-y-4 shadow-sm">
                             <div className="border-b border-gray-100 pb-2 mb-2"><label className="text-[10px] uppercase tracking-widest text-gray-400 font-bold">基本信息</label></div>
                             <div>
                                <label className="text-[10px] uppercase tracking-widest text-gray-400 block mb-2 font-bold">学员姓名 (Student)</label>
                                <input type="text" value={studentName} onChange={(e) => setStudentName(e.target.value)} className="w-full bg-gray-50 border border-gray-200 rounded px-3 py-2 text-gray-800 focus:outline-none focus:border-blue-500"/>
                            </div>
                            <div className="grid grid-cols-2 gap-3">
                                <div><label className="text-[10px] uppercase tracking-widest text-blue-900 block mb-1 font-bold">级别 (Level)</label><input type="text" value={level} onChange={(e) => setLevel(e.target.value)} className="w-full bg-gray-50 border border-blue-200 rounded px-3 py-2 text-blue-900 font-bold focus:outline-none focus:border-blue-500"/></div>
                                <div><label className="text-[10px] uppercase tracking-widest text-blue-900 block mb-1 font-bold">老师 (Teacher)</label><input type="text" value={teacherName} onChange={(e) => setTeacherName(e.target.value)} className="w-full bg-gray-50 border border-blue-200 rounded px-3 py-2 text-blue-900 font-bold focus:outline-none focus:border-blue-500"/></div>
                            </div>
                        </div>

                        <div className="bg-white p-5 rounded-xl border border-gray-200 space-y-4 shadow-sm">
                            <div className="border-b border-gray-100 pb-2 mb-4"><label className="text-[10px] uppercase tracking-widest text-gray-400 font-bold">学习内容详情</label></div>
                            <div className="space-y-3">
                                {[{ l: "文章题目", v: articleTitle, s: setArticleTitle }, { l: "阅读技巧", v: readingSkills, s: setReadingSkills }, { l: "词汇数量", v: vocabCount, s: setVocabCount }, { l: "语法知识", v: grammarKnowledge, s: setGrammarKnowledge }].map((f, i) => (
                                    <div key={i}><label className="text-[9px] text-gray-400 block mb-1">{f.l}</label><input type="text" value={f.v} onChange={(e) => f.s(e.target.value)} className="w-full bg-gray-50 border border-gray-200 rounded px-2 py-1.5 text-xs text-gray-700 focus:outline-none focus:border-blue-500"/></div>
                                ))}
                            </div>
                        </div>

                        <div className="bg-white p-5 rounded-xl border border-gray-200 space-y-4 shadow-sm">
                            <div className="border-b border-gray-100 pb-2 mb-2"><label className="text-[10px] uppercase tracking-widest text-gray-400 font-bold">能力评估 (0-100)</label></div>
                            <div className="space-y-3">
                                {Object.keys(radarData).map(key => (
                                    <div key={key} className="flex items-center gap-2">
                                        <span className="text-[10px] w-14 text-gray-600 font-bold">{key}</span>
                                        <input type="range" min="0" max="100" value={radarData[key]} onChange={(e) => updateRadarData(key, e.target.value)} className="flex-grow h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-600"/>
                                        <span className="text-[10px] w-6 text-right font-mono font-bold text-blue-900">{radarData[key]}</span>
                                    </div>
                                ))}
                            </div>
                        </div>

                        <div className="bg-white p-5 rounded-xl border border-gray-200 space-y-4 shadow-sm">
                            <div className="border-b border-gray-100 pb-2 mb-2"><label className="text-[10px] uppercase tracking-widest text-gray-400 font-bold">能力起点与成长蓝图设置</label></div>
                            <div className="grid grid-cols-2 gap-x-4 gap-y-2">
                                <div className="text-[10px] text-blue-900 font-bold mb-1 text-center">当前起点</div><div className="text-[10px] text-yellow-600 font-bold mb-1 text-center">6个月目标</div>
                                {[{ k: "level", l: "RE Level" }, { k: "lexile", l: "Lexile" }, { k: "cefr", l: "CEFR" }, { k: "ielts", l: "IELTS" }, { k: "toefl", l: "TOEFL" }, { k: "mse", l: "MSE" }].map((item, idx) => (
                                    <React.Fragment key={idx}>
                                        <div className="col-span-2 text-[9px] text-gray-400 mt-2">{item.l}</div>
                                        {item.k === 'level' ? <select value={growthData.start[item.k]} onChange={(e) => handleLevelChange('start', e.target.value)} className="session-select w-full bg-gray-50 border border-gray-200 rounded px-2 py-1 text-xs text-blue-900 font-bold text-center focus:outline-none focus:border-blue-500 cursor-pointer">{LEVEL_OPTIONS.map(lvl => <option key={lvl} value={lvl}>{lvl}</option>)}</select> : <input type="text" value={growthData.start[item.k]} onChange={(e) => updateGrowthData('start', item.k, e.target.value)} className="w-full bg-gray-50 border border-gray-200 rounded px-2 py-1 text-xs text-blue-900 font-bold text-center focus:outline-none focus:border-blue-500"/>}
                                        {item.k === 'level' ? <select value={growthData.target[item.k]} onChange={(e) => handleLevelChange('target', e.target.value)} className="session-select w-full bg-gray-50 border border-gray-200 rounded px-2 py-1 text-xs text-yellow-600 font-bold text-center focus:outline-none focus:border-yellow-500 cursor-pointer">{LEVEL_OPTIONS.map(lvl => <option key={lvl} value={lvl}>{lvl}</option>)}</select> : <input type="text" value={growthData.target[item.k]} onChange={(e) => updateGrowthData('target', item.k, e.target.value)} className="w-full bg-gray-50 border border-gray-200 rounded px-2 py-1 text-xs text-yellow-600 font-bold text-center focus:outline-none focus:border-yellow-500"/>}
                                    </React.Fragment>
                                ))}
                            </div>
                        </div>

                        <div className="bg-white p-5 rounded-xl border border-gray-200 space-y-4 shadow-sm">
                            <div className="flex justify-between items-center border-b border-gray-100 pb-2"><label className="text-[10px] uppercase tracking-widest text-gray-400 font-bold">能力诊断与提升建议</label><button onClick={addTip} className="text-blue-600 hover:text-blue-500"><Icon name="plus" /></button></div>
                            <div className="mb-3 mt-2"><select className="session-select w-full bg-blue-50 border border-blue-200 text-blue-900 text-xs rounded px-2 py-1.5 font-bold focus:outline-none focus:border-blue-500" onChange={(e) => applyCommentPreset(e.target.value)} defaultValue=""><option value="" disabled>✨ 选择 CEFR 评语模板 (自动填充)</option>{Object.keys(COMMENT_PRESETS).map(key => <option key={key} value={key}>{key}</option>)}</select></div>
                            <div className="space-y-6 pt-2">
                                {tips.map((tip) => (
                                    <div key={tip.id} className="bg-gray-50 p-3 rounded border border-gray-200 space-y-3">
                                        <div className="flex gap-2"><input type="text" value={tip.title} onChange={(e) => updateTip(tip.id, e.target.value)} className="flex-grow bg-white border border-blue-200 rounded px-2 py-1.5 text-xs text-gray-900 font-bold focus:outline-none focus:border-blue-500" placeholder="诊断点/建议标题"/><button onClick={() => removeTip(tip.id)} className="text-red-400 hover:text-red-500 p-1"><Icon name="trash" /></button></div>
                                        <div className="pl-3 space-y-2 border-l border-gray-200">
                                            <div className="flex justify-between items-center px-1"><span className="text-[9px] uppercase text-gray-400 font-bold">详细记录</span><button onClick={() => addSubTip(tip.id)} className="text-blue-600 hover:text-blue-500"><Icon name="plus" /></button></div>
                                            {(tip.subTips || []).map((sub, sIdx) => (
                                                <div key={sIdx} className="flex gap-2"><input type="text" value={sub} onChange={(e) => updateSubTip(tip.id, sIdx, e.target.value)} className="flex-grow bg-white border border-gray-200 rounded px-2 py-1 text-[10px] text-gray-600 focus:outline-none focus:border-blue-500" placeholder="细节..."/><button onClick={() => removeSubTip(tip.id, sIdx)} className="text-red-300 hover:text-red-500 p-1"><Icon name="trash" /></button></div>
                                            ))}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>

                        <button onClick={handleExport} disabled={isExporting} className={`flex-shrink-0 bg-yellow-500 hover:bg-yellow-400 text-black font-bold py-3 rounded-lg flex items-center justify-center gap-2 transition-all shadow-xl ${isExporting ? 'opacity-70 cursor-not-allowed' : ''}`}><Icon name={isExporting ? "loader" : "download"} /> {isExporting ? "正在生成图片..." : "导出学习报告"}</button>
                    </aside>
                    <main className="flex-grow flex flex-col items-center justify-start overflow-y-auto custom-scrollbar">
                        <div className="mb-4 flex items-center gap-4 bg-white rounded-full px-6 py-2 border border-gray-200 text-xs font-bold uppercase text-blue-900 shadow-sm">实时预览 (Live Preview)</div>
                        <div className="py-4"><SessionPosterCard innerRef={posterRef} studentName={studentName} teacherName={teacherName} level={level} articleTitle={articleTitle} readingSkills={readingSkills} vocabCount={vocabCount} grammarKnowledge={grammarKnowledge} radarData={radarData} tips={tips} growthData={growthData} /></div>
                        <div className="mt-6 mb-10 flex items-center gap-3 text-gray-400 text-[10px] bg-white px-4 py-2 rounded-full border border-gray-200 uppercase tracking-widest shadow-sm"><Icon name="check" /><span>v12.6 数据修正版</span></div>
                    </main>
                </div>
            );
        };

        // ==========================================
        // MODULE 2: Course Report (End of Term)
        // ==========================================

        const DEFAULT_READING_STAGES = [
            { title: "启读阶", desc: "初识打卡·每日阅读·养成习惯", id: 0 },
            { title: "探读阶", desc: "主动精读·梳理核心·积累词汇", id: 1 },
            { title: "精读阶", desc: "熟用方法·梳理逻辑·提炼大意", id: 2 },
            { title: "思读阶", desc: "深度理解·分析手法·语境猜词", id: 3 },
            { title: "乐读阶", desc: "自主拓展·享受阅读·以读会用", id: 4 }
        ];

        const STAGE_UNLOCK_MESSAGES = [
            "启读进阶已就位，专属你的「探读者」身份，正等待被解锁～",
            "探读进阶已就位，专属你的「精读者」身份，正等待被解锁～",
            "精读进阶已就位，专属你的「思读者」身份，正等待被解锁～",
            "思读进阶已就位，专属你的「乐读者」身份，正等待被解锁～",
            "乐读进阶已达成，愿你在阅读的世界里自由翱翔，终身学习～"
        ];

        const OVERALL_PRESETS = {
            "🌟 全能五边形战士": "亲爱的同学，在过去的这段打卡时光里，你几乎每天都在坚持，每一次作业提交都见证了你的全情投入。从听力到阅读，从词汇到表达，你像一位不知疲倦的战士，攻克了一个又一个难关。看着你从最初的生涩试探，到如今各项能力均衡向上生长，老师真心为你感到骄傲！这份坚持，终将汇聚成星辰大海。",
            "🔥 词汇筑梦师": "恭喜你荣获「词汇筑梦师」称号！翻看你的打卡记录，最让老师感动的是你对词汇积累的执着。哪怕是生僻的单词，你也会反复练习直到精准掌握。这一路走来，你用单词搭建起了一座通往世界的桥梁。看着你从最初的词汇匮乏到如今的信手拈来，这朵坚持的花，在时光里开得真美！",
            "🧭 阅读领航者": "恭喜你获得「阅读领航者」头衔！在每一个坚持打卡的日子里，你都在书海中从容远航。你不仅是在阅读文字，更是在与作者进行灵魂的对话。看着你从最初只能读懂字面意思，到如今能深刻理解文章背后的逻辑与情感，老师倍感欣慰。这背后每一步都藏着不为人知的努力，你的每一次思考，都是成长路上最美的风景。",
            "🧩 语法逻辑家": "恭喜你成为「语法逻辑家」！学习是一场马拉松，而你用严谨的态度跑出了最美的姿态。在过去的打卡中，你对每一个长难句的拆解、对每一个语法点的运用都一丝不苟。看着你从最初的懵懂到现在的条理清晰，老师看到了你背后的汗水。这份求真务实的精神，比满分更珍贵！",
            "💡 思辨哲学家": "亲爱的同学，在这一百多天的陪伴中，老师最欣赏你打卡时展现出的独立思考。你从不满足于标准答案，总能在阅读中提出自己独到的见解。看着你的思想在时光里慢慢发芽、开花，这种成长的喜悦是无法言喻的。愿你继续保持这份敏锐，去探索更深邃的世界。",
            "🗣️ 卓越表达者": "恭喜你获得「卓越表达者」美誉！每一次点开你的口语打卡，都能感受到你屏幕那端的认真与热情。从最初的生涩试探，到如今能流利、自信地表达观点，你的声音越来越有力量。这背后无数次的开口练习，都化作了此刻的从容。老师为你点赞，你的声音值得被全世界听到！",
            "✨ 潜力新星": "恭喜你点亮「潜力新星」徽章！回首这段打卡时光，你给了老师太多惊喜。也许开始时你还有些犹豫，但你从未放弃。看着你一天天坚持下来，最晚的一次打卡甚至快到凌晨了。每一次订正、每一次重录都藏着不为人知的努力。成长或许缓慢，但从未缺席，你正在绽放属于自己的光芒！",
            "🏃 毅力长跑者": "恭喜你赢得「毅力长跑者」勋章！学习是一场没有终点的马拉松，而你拥有最宝贵的品质——坚持。看着日历上密密麻麻的打卡记录，从晨光熹微到夜深人静，你的每一步都走得踏实而坚定。这份日复一日的坚持，不仅让你收获了知识，更磨练了强大的内心。为你点赞！",
            "🔭 灵感探险家": "恭喜你解锁「灵感探险家」成就！你对英语世界充满了好奇心，每一次阅读对你来说都是一次全新的探险。你善于发现文章中的趣味，总能提出意想不到的问题。保持这份好奇与热爱，它是你探索知识宇宙的飞船，愿你发现更多未知的精彩！",
            "🎨 细节雕刻家": "恭喜你荣获「细节雕刻家」称号！你对待学习像艺术家对待作品一样精益求精。无论是单词的拼写还是语法的细节，你都不放过任何一个瑕疵。正是这种严谨细致的态度，让你的语言能力日臻完美。看着你每一次认真的订正，老师都深受感动！"
        };

        const CourseRadarChart = ({ currentData, initialData, size = 240 }) => {
            const center = size / 2;
            const radius = size * 0.25; 
            const levels = 4; 
            const keys = ["词汇掌握", "语法运用", "听说表达", "阅读能力", "写作能力"];
            
            const getCoordinates = (value, index, total, maxVal = 100) => {
                const angle = (Math.PI * 2 * index) / total - Math.PI / 2;
                const r = (value / maxVal) * radius;
                return { x: center + r * Math.cos(angle), y: center + r * Math.sin(angle) };
            };
            
            const getTextCoordinates = (value, index, total, offsetType) => {
                const angle = (Math.PI * 2 * index) / total - Math.PI / 2;
                let r = (value / 100) * radius;
                if (offsetType === 'inner') r = Math.max(r - 18, 10);
                else if (offsetType === 'outer') r = r + 15;
                return { x: center + r * Math.cos(angle), y: center + r * Math.sin(angle) };
            };

            const gridPoints = useMemo(() => {
                const grids = [];
                for (let i = 1; i <= levels; i++) {
                    const points = [];
                    for (let j = 0; j < keys.length; j++) {
                        const { x, y } = getCoordinates(100 * (i / levels), j, keys.length);
                        points.push(`${x},${y}`);
                    }
                    grids.push(points.join(" "));
                }
                return grids;
            }, [levels, keys.length]);

            const getPolygonPoints = (data) => {
                const points = keys.map((key, i) => {
                    const val = data[key] || 0;
                    const { x, y } = getCoordinates(val, i, keys.length);
                    return `${x},${y}`;
                });
                return points.join(" ");
            };

            const currentPoints = useMemo(() => getPolygonPoints(currentData), [currentData, keys]);
            const initialPoints = useMemo(() => getPolygonPoints(initialData), [initialData, keys]);

            const labels = keys.map((key, i) => {
                const { x, y } = getCoordinates(160, i, keys.length);
                return { key, x, y };
            });

            return (
                <div className="flex flex-row items-center justify-center py-2 gap-4">
                    <svg width={size} height={size} viewBox={`0 0 ${size} ${size}`} className="overflow-visible">
                        {gridPoints.map((points, i) => <polygon key={i} points={points} fill="none" stroke="#cbd5e1" strokeWidth="1" />)}
                        {keys.map((_, i) => {
                            const { x, y } = getCoordinates(100, i, keys.length);
                            return <line key={i} x1={center} y1={center} x2={x} y2={y} stroke="#cbd5e1" strokeWidth="1" />;
                        })}
                        <polygon points={initialPoints} fill="rgba(30, 58, 138, 0.05)" stroke="#1e3a8a" strokeWidth="1.5" strokeDasharray="3 3" />
                        {keys.map((key, i) => {
                             const val = initialData[key] || 0;
                             const { x, y } = getCoordinates(val, i, keys.length);
                             const textPos = getTextCoordinates(val, i, keys.length, 'inner');
                             return (
                                <g key={`init-${i}`}>
                                    <circle cx={x} cy={y} r="2.5" fill="white" stroke="#1e3a8a" strokeWidth="1" />
                                    <text x={textPos.x} y={textPos.y + 3} textAnchor="middle" dominantBaseline="middle" className="text-halo text-[8px] font-bold export-fix-sm" style={{ fill: '#1e3a8a', fontFamily: 'sans-serif' }}>{val}</text>
                                </g>
                             );
                        })}
                        <polygon points={currentPoints} fill="rgba(250, 204, 21, 0.3)" stroke="#FACC15" strokeWidth="2.5" />
                        {keys.map((key, i) => {
                             const val = currentData[key] || 0;
                             const { x, y } = getCoordinates(val, i, keys.length);
                             const textPos = getTextCoordinates(val, i, keys.length, 'outer');
                             return (
                                <g key={`curr-${i}`}>
                                    <circle cx={x} cy={y} r="3.5" fill="#1e3a8a" stroke="#FACC15" strokeWidth="1.5" />
                                    <text x={textPos.x} y={textPos.y + 3} textAnchor="middle" dominantBaseline="middle" className="text-halo text-[9px] font-bold export-fix-sm" style={{ fill: '#ffffff', fontFamily: 'sans-serif' }}>{val}</text>
                                    <text x={textPos.x} y={textPos.y + 3} textAnchor="middle" dominantBaseline="middle" className="text-[9px] fill-blue-900 font-bold export-fix-sm" style={{ fontFamily: 'sans-serif', fontWeight: '800' }}>{val}</text>
                                </g>
                             );
                        })}
                        {labels.map((label, i) => <text key={i} x={label.x} y={label.y} textAnchor="middle" dominantBaseline="middle" fill="#1e293b" className="text-[11px] font-bold tracking-widest export-fix-base" style={{ fontFamily: '"Microsoft YaHei", sans-serif' }}>{label.key}</text>)}
                    </svg>
                    <div className="flex flex-col gap-3 justify-center">
                        <div className="flex items-center gap-2"><span className="w-2.5 h-2.5 rounded-full border border-blue-900 border-dashed bg-blue-50"></span><span className="text-[9px] text-gray-500 font-bold export-fix-base">入学/末次</span></div>
                        <div className="flex items-center gap-2"><span className="w-2.5 h-2.5 rounded-full bg-yellow-400 border border-yellow-500"></span><span className="text-[9px] text-gray-800 font-bold export-fix-base">目前评估</span></div>
                    </div>
                </div>
            );
        };

        const CourseGrowthChart = ({ start, current, target, width = 330, height = 230 }) => { 
            const dimensions = [{ key: "level", label: "RE Level" }, { key: "lexile", label: "Lexile" }, { key: "cefr", label: "CEFR" }, { key: "ielts", label: "IELTS" }, { key: "toefl", label: "TOEFL" }, { key: "mse", label: "MSE" }];
            const normalize = (key, value) => {
                let valStr = String(value || 0).toUpperCase().trim();
                const extractNum = (str) => { const match = str.match(/([\d.]+)\s*[-]\s*([\d.]+)/); if (match) return (parseFloat(match[1]) + parseFloat(match[2])) / 2; return parseFloat(str.replace(/[^0-9.]/g, '')) || 0; };
                if (key === 'level') { const levelMap = { 'LEVEL 0': 0, 'FOUNDATIONS': 14, 'LEVEL 1': 28, 'LEVEL 2': 42, 'LEVEL 3': 56, 'LEVEL 4': 70, 'LEVEL 5': 84, 'C2': 100 }; for (let k in levelMap) { if (valStr.includes(k)) return levelMap[k]; } const num = extractNum(valStr); return Math.min(100, (num / 6) * 100); }
                if (key === 'lexile') { const num = extractNum(valStr); return Math.min(100, (num / 1300) * 100); }
                if (key === 'cefr') { if (valStr.includes('C2')) return 100; if (valStr.includes('C1')) return 90; if (valStr.includes('B2+')) return 80; if (valStr.includes('B2')) return 70; if (valStr.includes('B1+')) return 60; if (valStr.includes('B1')) return 50; if (valStr.includes('A2+')) return 40; if (valStr.includes('A2')) return 30; if (valStr.includes('A1')) return 15; return 20; }
                if (key === 'ielts') { if (valStr.includes('7.0-8.0')) return 92; if (valStr.includes('5.5-6.5')) return 78; if (valStr.includes('5.0-6.0')) return 65; if (valStr === '5.0') return 52; if (valStr.includes('4.5-5.0')) return 40; if (valStr.includes('3.5-4.5')) return 25; if (valStr.includes('3.0')) return 10; const num = extractNum(valStr); return Math.min(100, (num / 9) * 100); }
                if (key === 'toefl') { const num = extractNum(valStr); return num > 120 ? Math.min(100, (num / 900) * 100) : Math.min(100, (num / 120) * 100); }
                if (key === 'mse') { if (valStr.includes('FLYERS')) return 10; if (valStr.includes('KET')) return 25; if (valStr.includes('PET+')) return 55; if (valStr.includes('PET')) return 40; if (valStr.includes('FCE+')) return 85; if (valStr.includes('FCE')) return 70; if (valStr.includes('CAE')) return 95; if (valStr.includes('CPE')) return 100; return 20; }
                return 50;
            };
            const padding = { top: 25, right: 20, bottom: 30, left: 25 }; 
            const chartWidth = width - padding.left - padding.right;
            const chartHeight = height - padding.top - padding.bottom;
            const stepX = chartWidth / (dimensions.length - 1);
            const safeStart = start || {}, safeCurrent = current || {}, safeTarget = target || {};
            const startPoints = dimensions.map((d, i) => ({ x: i * stepX + padding.left, y: chartHeight - (normalize(d.key, safeStart[d.key]) / 100) * chartHeight + padding.top, val: safeStart[d.key] || '' }));
            const currentPoints = dimensions.map((d, i) => ({ x: i * stepX + padding.left, y: chartHeight - (normalize(d.key, safeCurrent[d.key]) / 100) * chartHeight + padding.top, val: safeCurrent[d.key] || '' }));
            const targetPoints = dimensions.map((d, i) => ({ x: i * stepX + padding.left, y: chartHeight - (normalize(d.key, safeTarget[d.key]) / 100) * chartHeight + padding.top, val: safeTarget[d.key] || '' }));
            const createPath = (points) => points.map((p, i) => (i === 0 ? `M ${p.x} ${p.y}` : `L ${p.x} ${p.y}`)).join(' ');
            const areaPath = `${createPath(startPoints)} L ${targetPoints[targetPoints.length - 1].x} ${targetPoints[targetPoints.length - 1].y} ${targetPoints.slice().reverse().map(p => `L ${p.x} ${p.y}`).join(' ')} Z`;
            const renderSmartLabels = () => {
                const elements = [];
                elements.push(<path key="area" d={areaPath} fill="rgba(255, 221, 0, 0.15)" stroke="none" />);
                elements.push(<path key="line-start" d={createPath(startPoints)} fill="none" stroke="#1e3a8a" strokeWidth="2" strokeDasharray="4 2" />);
                elements.push(<path key="line-current" d={createPath(currentPoints)} fill="none" stroke="#22d3ee" strokeWidth="2.5" />);
                elements.push(<path key="line-target" d={createPath(targetPoints)} fill="none" stroke="#ca8a04" strokeWidth="2" />);
                for (let i = 0; i < dimensions.length; i++) {
                    const s = startPoints[i], c = currentPoints[i], t = targetPoints[i];
                    const points = [{ type: 'start', y: s.y, val: s.val, color: '#1e3a8a' }, { type: 'current', y: c.y, val: c.val, color: '#0891b2', isMain: true }, { type: 'target', y: t.y, val: t.val, color: '#ca8a04' }];
                    points.sort((a, b) => a.y - b.y);
                    const labeledPoints = points.map((p, idx) => {
                        let yOffset = -14, xOffset = 0, anchor = "middle";
                        if (idx === 0) yOffset = -14; else if (idx === 2) yOffset = 18; else { const prev = points[0], next = points[2]; const distToTop = p.y - prev.y, distToBottom = next.y - p.y; if (distToTop < 22 && distToBottom < 22) { yOffset = 4; xOffset = 8; anchor = "start"; } else if (distToTop < 22) yOffset = 18; else if (distToBottom < 22) yOffset = -14; }
                        return { ...p, yOffset, xOffset, anchor };
                    });
                    elements.push(<g key={`dots-${i}`}><circle cx={s.x} cy={s.y} r="2.5" fill="white" stroke="#1e3a8a" strokeWidth="1.5" /><circle cx={t.x} cy={t.y} r="2.5" fill="white" stroke="#ca8a04" strokeWidth="1.5" /><circle cx={c.x} cy={c.y} r="3" fill="white" stroke="#22d3ee" strokeWidth="2" /></g>);
                    labeledPoints.forEach(l => elements.push(<text key={`txt-${i}-${l.type}`} x={s.x + l.xOffset} y={l.y + l.yOffset} textAnchor={l.anchor} dominantBaseline="middle" className="text-halo export-fix-sm" style={{ fontFamily: 'sans-serif', fontSize: l.isMain ? '6.5px' : '5.5px', fontWeight: 'bold', fill: l.color, pointerEvents: 'none' }}>{l.val}</text>));
                }
                return elements;
            };
            return (<div className="flex justify-center items-center w-full"><svg width={width} height={height} className="overflow-visible">{dimensions.map((d, i) => <text key={i} x={i * stepX + padding.left} y={height - 5} textAnchor="middle" dominantBaseline="middle" className="text-[8px] font-bold fill-gray-500 uppercase tracking-tighter export-fix-base" style={{ fontFamily: '"Oswald", sans-serif' }}>{d.label}</text>)}{renderSmartLabels()}</svg></div>);
        };

        const UnifiedApp = () => {
            const [activeTab, setActiveTab] = useState('session'); // 'session' or 'course'

            return (
                <div className="min-h-screen flex flex-col font-sans">
                    <div className="bg-slate-800 text-white p-4 shadow-lg flex items-center justify-between z-30">
                        <div className="flex items-center gap-3">
                            <div className="w-8 h-8 bg-yellow-500 rounded flex items-center justify-center font-bold text-slate-900">RE</div>
                            <h1 className="font-['Oswald'] text-lg uppercase tracking-wider">Report Generator System</h1>
                        </div>
                        <div className="flex bg-slate-700 rounded p-1">
                            <button 
                                onClick={() => setActiveTab('session')} 
                                className={`px-4 py-1.5 rounded text-sm font-bold transition-all ${activeTab === 'session' ? 'bg-yellow-500 text-slate-900 shadow-md' : 'text-slate-300 hover:text-white'}`}
                            >
                                体验营学习报告(Trial)
                            </button>
                            <button 
                                onClick={() => setActiveTab('course')} 
                                className={`px-4 py-1.5 rounded text-sm font-bold transition-all ${activeTab === 'course' ? 'bg-gradient-to-r from-blue-500 to-purple-500 text-white shadow-md' : 'text-slate-300 hover:text-white'}`}
                            >
                                结课报告 (End of Course)
                            </button>
                        </div>
                    </div>

                    <div className="flex-grow bg-gray-50 relative">
                        {activeTab === 'session' ? (
                            <div className="p-4 md:p-8 h-full overflow-y-auto">
                                <SessionReportApp />
                            </div>
                        ) : (
                            <div className="h-[calc(100vh-64px)] overflow-hidden">
                                <CourseReportApp />
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<UnifiedApp />);
    </script>
</body>
</html>